##########################################################################
# This file contains MiCADO Profile type definitions.
##########################################################################

tosca_definitions_version: tosca_2_0

profile: eu.swarmchestrate:0.1

metadata:
  template_name: profile.yaml
  template_author: University of Westminster
  template_version: 0.1

description: MiCADO Profile type definitions

node_types:

  Swarm:
    description: >
      The Swarmchestrate Swarm node represents the resources that come
      together to form a swarm.
    properties:
      name:
        type: string
        required: false
        description: >
          The name of the swarm.

  Application:
    description: >
      The Swarmchestrate Application node represents a Kubernetes Deployment.
    properties:
      image:
        type: string
        required: false
        description: >
          The container image to deploy for this application.

      env:
        type: list
        required: false
        description: >
          Environment variables to set in the container.
        entry_schema:
          type: map

      ports:
        type: list
        required: false
        description: >
          List of ports to expose from the container.
        entry_schema:
          type: map

      args:
        type: list
        required: false
        description: >
          List of ports to expose from the container.
        entry_schema:
          type: string
    requirements:
      - host:
          capability: Resource
          relationship: HostedOn
      - volume:
          capability: Volume
          relationship: AttachedTo

  Resource:
    description: >
      The Swarmchestrate Resource node represents a cloud or edge instance

  EC2.micro.t3:
    derived_from: Resource
    description: >
      An EC2 compute node from the University of Westminster provision
    properties:
      region_name:
        type: string
        required: true
        description: >
          AWS region defaults to us-east-1
        default: us-east-1
      image_id:
        type: string
        required: true
        description: >
          The ID of the Amazon Machine Image (AMI) used to launch the EC2 instance.
        default: ami-0c02fb55956c7d316
      instance_type:
        type: string
        required: true
        default: t3.micro
        description: >
          The type of EC2 instance (e.g., t2.micro, m5.large) specifying compute resources.
      key_name:
        type: string
        required: false
        description: >
          The name of the SSH key pair used to access the EC2 instance.
        default: g-key
      security_group_ids:
        type: list
        required: false
        entry_schema: string
        description: >
          A list of security group IDs that control inbound and outbound traffic for the EC2 instance.
        default:
        - sg-0bb1c123456789abc
      tags:
        type: map
        required: false
        entry_schema: string
        description: >
          Key-value pairs used to tag and categorise the EC2 instance (e.g., environment: production).
        default:
          managed_by: swarmchestrate
    capabilities:
      host:
        type: Resource
        properties:
          num-cpus:
            type: integer
            required: true
            description: Number of vCPUs
            default: 2
          mem-size:
            type: integer
            required: true
            description: Memory size in GB
            default: 1
          disk-size:
            type: integer
            required: true
            description: Disk size in GB
            default: 20
          bandwidth:
            type: integer
            required: true
            description: Network bandwidth in Mbps
            default: 100
      os:
        properties:
          type:
            type: string
            required: true
            description: Operating system type
            default: linux
          version:
            type: string
            required: true
            description: Operating system version
            default: "22.04"
          distribution:
            type: string
            required: true
            description: Operating system distribution 
            default: ubuntu
      resource:
        properties:
          provider:
            type: string
            required: true
            description: Resource provider
            default: Amazon
          capacity-provider:
            type: string
            required: true
            description: Capacity provider
            default: uow
          type:
            type: string
            required: true
            description: Resource type
            default: cloud
      pricing:
        properties:
          cost:
            type: float
            required: true
            description: Cost per hour in USD
            default: 0.0139
      locality:
        properties:
          continent:
            type: string
            required: true
            description: Continent where the resource is located
            default: N.America
          country:
            type: string
            required: true
            description: Country where the resource is located
            default: USA
          city:
            type: string
            required: true
            description: City where the resource is located
            default: N.Virginia
      energy:
        properties:
          consumption:
            type: float
            required: true
            description: Energy consumption in watts per hour
            default: 13.0
          powered-type:
            type: string
            required: false
            description: Type of power used (e.g., renewable, non-renewable)
            default: mains-powered
          energy-type:
            type: string
            required: false
            description: Specific type of energy (e.g., solar, wind, coal)
            default: non-green

  Volume.HostPath:
    description: >
      The MiCADO Compute node represents a virtual machine in the cloud
      that supports a container runtime.
    properties:
      path:
        type: string
        required: false
        description: >
          The path on the host machine to mount as a volume.
          
policy_types:

  QoS:
    description: >
      Quality of Service (QoS) policies for applications.
    properties:
      priority:
        type: float
        required: false
        description: >
          Priority level of the application (higher number means higher priority).
      target:
        type: integer
        required: false
        description: >
          Target value for the QoS metric.

  QoS.Energy.Budget:
    description: >
      Energy policy type
    derived_from: QoS

  QoS.Cost.Budget:
    description: >
      Cost policy type
    derived_from: QoS

  QoS.Performance.Bandwidth:
    description: >
      Bandwidth policy type
    derived_from: QoS

  QoS.Performance.Latency:
    description: >
      Latency policy type
    derived_from: QoS


relationship_types:

  HostedOn:
    description: >
      This relationship indicates that a node is hosted on another node.

  AttachedTo:
    description: >
      This relationship indicates that a volume is attached to a container.

capability_types:

  Resource:
    description: >
      This capability represents a resource that can host applications.

  Volume:
    description: >
      This capability represents a volume that can be attached to a container.