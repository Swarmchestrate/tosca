##########################################################################
# This file contains MiCADO Profile Monitoring type definitions.
##########################################################################

tosca_definitions_version: tosca_2_0

profile: eu.swarmchestrate:0.1

metadata:
  template_name: monitoring.yaml
  template_author: UoW & ICCS
  template_version: 0.1

description: MiCADO Profile monitoring type definitions


data_types:

  RawMetric:
    properties:
      name:
        type: string
        required: true
        description: Name of the raw metric
      sensor:
        type: string
        required: true
        description: Sensor type
        default: Netdata
      config:
        type: map
        required: true
        entry_schema: string
        description: |
          Configuration for the metric e.g.
            scope_contexts: k8s.cgroup.cpu
            results-aggregation: SUM
      collection_frequency:
        type: string
        required: true
        description: Frequency of collection e.g. "30 sec"
        default: "30 sec"
      collection_output:
        type: string
        required: true
        description: Output type e.g. "all"
        default: "all"

  CompositeMetric:
    description: >
      Composite metric definition.
    properties:
      name:
        type: string
        required: true
        description: Name of the composite metric
      formula:
        type: string
        required: true
        description: Formula for the composite metric e.g. mean( cpu_util_instance )
      collection_frequency:
        type: string
        required: true
        description: Frequency of collection e.g. "30 sec"
        default: "30 sec"
      collection_output:
        type: string
        required: true
        description: Output type e.g. "all"
        default: "all"
      window_type:
        type: string
        required: true
        description: Type of window e.g. "sliding"
        default: "sliding"
      window_size:
        type: string
        required: true
        description: Size of the window e.g. "5 min"
      grouping:
        type: string
        required: true
        description: >
          Grouping type e.g. "per_zone", "per_host", "per_region" # possibly "cross-swarms"
        default: "per_zone"

  SLO:
    description: >
      Service Level Objective (SLO) data type.
    properties:
      name:
        type: string
        required: true
        description: Name of the SLO
      metric:
        type: string
        required: false
        description: Name of the metric to apply the SLO on
      operator:
        type: string
        required: false
        description: Operator for the SLO e.g. ">"
      threshold:
        type: float
        required: false
        description: Threshold value for the SLO e.g. 80.0
      and_list:
        type: list
        entry_schema: SLO
        required: false
        description: List of SLOs to AND together
      or_list:
        type: list
        entry_schema: SLO
        required: false
        description: List of SLOs to OR together
      constraint:
        type: string
        required: false
        description: Constraint for the SLO e.g. "cpu_util_prct > 80"