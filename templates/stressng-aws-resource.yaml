tosca_definitions_version: tosca_2_0

description: stressng on Swarmchestrate AWS

imports:
- namespace: swch
  url: https://raw.githubusercontent.com/Swarmchestrate/tosca/refs/heads/main/profiles/eu.swarmchestrate/profile.yaml
  #url: file:///workspaces/tosca/profiles/eu.swarmchestrate/profile.yaml

service_template:

  node_templates:

    swarm:
      type: swch:Swarm
      directives:
      - substitute
    
    resource-1:
      type: swch:EC2.micro.t3
      properties:
        custom_ingress_ports:
          from: 80
          to: 80
          protocol: tcp
          source: 0.0.0.0/0
        custom_egress_ports:
          from: 0
          to: 65535
          protocol: tcp
          destination: 0.0.0.0/0

    stressng:
      type: swch:Application
      properties:
        image: lorel/docker-stress-ng
        args: ['--cpu', '0', '--cpu-method', 'pi', '-l', '20']
        ports:
        - port: 80
          targetPort: 80
          nodePort: 30080
        - port: 443
          targetPort: 443
          nodePort: 30443
      requirements:
      - host: resource-1
